function a0_0x27f2(_0x3a4935,_0x1bffac){const _0x3ce8ff=a0_0x3ce8();return a0_0x27f2=function(_0x27f20b,_0x5d7f31){_0x27f20b=_0x27f20b-0x17b;let _0x3c47a1=_0x3ce8ff[_0x27f20b];return _0x3c47a1;},a0_0x27f2(_0x3a4935,_0x1bffac);}(function(_0x59281e,_0x198756){const _0x3a2142=a0_0x27f2,_0x5db3fd=_0x59281e();while(!![]){try{const _0x400b0a=-parseInt(_0x3a2142(0x1b4))/0x1+-parseInt(_0x3a2142(0x1a5))/0x2*(parseInt(_0x3a2142(0x1b5))/0x3)+parseInt(_0x3a2142(0x1a4))/0x4+-parseInt(_0x3a2142(0x18d))/0x5+-parseInt(_0x3a2142(0x18e))/0x6+-parseInt(_0x3a2142(0x1c3))/0x7+parseInt(_0x3a2142(0x18f))/0x8*(parseInt(_0x3a2142(0x1a6))/0x9);if(_0x400b0a===_0x198756)break;else _0x5db3fd['push'](_0x5db3fd['shift']());}catch(_0x21ef59){_0x5db3fd['push'](_0x5db3fd['shift']());}}}(a0_0x3ce8,0xc3227),function(_0x4daebc,_0x242f3f){const _0x1b64d4=a0_0x27f2,_0x32c986=a0_0x4f8f,_0x574b63=_0x4daebc();while(!![]){try{const _0x41b1ce=-parseInt(_0x32c986(0xd3))/0x1+-parseInt(_0x32c986(0xd0))/0x2*(parseInt(_0x32c986(0xe3))/0x3)+-parseInt(_0x32c986(0x102))/0x4*(parseInt(_0x32c986(0xf2))/0x5)+parseInt(_0x32c986(0xdd))/0x6+-parseInt(_0x32c986(0xdb))/0x7*(parseInt(_0x32c986(0xe2))/0x8)+parseInt(_0x32c986(0xea))/0x9+-parseInt(_0x32c986(0xf3))/0xa*(-parseInt(_0x32c986(0xcd))/0xb);if(_0x41b1ce===_0x242f3f)break;else _0x574b63[_0x1b64d4(0x196)](_0x574b63[_0x1b64d4(0x1be)]());}catch(_0x4e7c68){_0x574b63[_0x1b64d4(0x196)](_0x574b63[_0x1b64d4(0x1be)]());}}}(a0_0x483c,0x7cd28));import{connect}from'cloudflare:sockets';import a0_0x2daac4 from'js-sha256';export async function trojanOverWSHandler(_0x38fd13){const _0x2f1086=a0_0x4f8f,_0x3844b4=new WebSocketPair(),[_0x2d664b,_0x641249]=Object[_0x2f1086(0x10a)](_0x3844b4);_0x641249[_0x2f1086(0xf0)]();let _0x244c07='',_0x4ea2cb='';const _0x17089a=(_0x157d44,_0x5a4dc9)=>{console['log']('['+_0x244c07+':'+_0x4ea2cb+']\x20'+_0x157d44,_0x5a4dc9||'');},_0xb62824=_0x38fd13[_0x2f1086(0x100)][_0x2f1086(0xf4)](_0x2f1086(0xda))||'',_0x190581=makeReadableWebSocketStream(_0x641249,_0xb62824,_0x17089a);let _0xf00910={'value':null},_0x8ccfe9=null;return _0x190581[_0x2f1086(0xdc)](new WritableStream({async 'write'(_0x28e2cf,_0xe6f0e){const _0x37955a=_0x2f1086;if(_0x8ccfe9)return _0x8ccfe9(_0x28e2cf);if(_0xf00910[_0x37955a(0x107)]){const _0x942262=_0xf00910[_0x37955a(0x107)][_0x37955a(0xe4)][_0x37955a(0xff)]();await _0x942262['write'](_0x28e2cf),_0x942262[_0x37955a(0xe6)]();return;}const {hasError:_0x255d0a,message:_0xa3e47c,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawClientData:_0x3fd647}=await parseTrojanHeader(_0x28e2cf);_0x244c07=addressRemote,_0x4ea2cb=portRemote+'--'+Math[_0x37955a(0xd9)]()+_0x37955a(0xf5);if(_0x255d0a){throw new Error(_0xa3e47c);return;}handleTCPOutBound(_0xf00910,addressRemote,portRemote,_0x3fd647,_0x641249,_0x17089a);},'close'(){const _0x1f8601=a0_0x27f2;_0x17089a(_0x1f8601(0x1bf));},'abort'(_0x15725a){const _0x479b51=_0x2f1086;_0x17089a(_0x479b51(0x10f),JSON[_0x479b51(0xd5)](_0x15725a));}}))[_0x2f1086(0xfa)](_0x2832d8=>{const _0x43624e=_0x2f1086;_0x17089a(_0x43624e(0x109),_0x2832d8);}),new Response(null,{'status':0x65,'webSocket':_0x2d664b});}async function parseTrojanHeader(_0x49fdf1){const _0x14fe00=a0_0x27f2,_0x43d3a2=a0_0x4f8f;if(_0x49fdf1[_0x43d3a2(0xd7)]<0x38)return{'hasError':!![],'message':_0x43d3a2(0x106)};let _0x393f42=0x38;if(new Uint8Array(_0x49fdf1[_0x43d3a2(0x10d)](0x38,0x39))[0x0]!==0xd||new Uint8Array(_0x49fdf1[_0x14fe00(0x1c5)](0x39,0x3a))[0x0]!==0xa)return{'hasError':!![],'message':_0x43d3a2(0xe1)};const _0x4b07b5=new TextDecoder()[_0x43d3a2(0x105)](_0x49fdf1[_0x43d3a2(0x10d)](0x0,_0x393f42));if(_0x4b07b5!==a0_0x2daac4[_0x14fe00(0x1c6)](globalThis[_0x43d3a2(0x10e)]))return{'hasError':!![],'message':_0x43d3a2(0xed)};const _0x4b8f5e=_0x49fdf1[_0x43d3a2(0x10d)](_0x393f42+0x2);if(_0x4b8f5e[_0x43d3a2(0xd7)]<0x6)return{'hasError':!![],'message':_0x14fe00(0x194)};const _0x2a2ecd=new DataView(_0x4b8f5e),_0x33faa8=_0x2a2ecd[_0x43d3a2(0xf9)](0x0);if(_0x33faa8!==0x1)return{'hasError':!![],'message':_0x43d3a2(0xf7)};const _0x165fe5=_0x2a2ecd[_0x43d3a2(0xf9)](0x1);let _0x1c5733=0x0,_0x191dd9=0x2,_0x1b493b='';switch(_0x165fe5){case 0x1:_0x1c5733=0x4,_0x1b493b=new Uint8Array(_0x4b8f5e[_0x43d3a2(0x10d)](_0x191dd9,_0x191dd9+_0x1c5733))[_0x43d3a2(0xe5)]('.');break;case 0x3:_0x1c5733=new Uint8Array(_0x4b8f5e[_0x43d3a2(0x10d)](_0x191dd9,_0x191dd9+0x1))[0x0],_0x191dd9+=0x1,_0x1b493b=new TextDecoder()[_0x14fe00(0x1ae)](_0x4b8f5e[_0x14fe00(0x1c5)](_0x191dd9,_0x191dd9+_0x1c5733));break;case 0x4:_0x1c5733=0x10;const _0x2b4e79=new DataView(_0x4b8f5e[_0x43d3a2(0x10d)](_0x191dd9,_0x191dd9+_0x1c5733)),_0x185301=[];for(let _0x9916b1=0x0;_0x9916b1<0x8;_0x9916b1++){_0x185301[_0x43d3a2(0xec)](_0x2b4e79[_0x14fe00(0x1aa)](_0x9916b1*0x2)[_0x43d3a2(0xef)](0x10));}_0x1b493b=_0x185301[_0x43d3a2(0xe5)](':');break;default:return{'hasError':!![],'message':_0x43d3a2(0xeb)+_0x165fe5};}if(!_0x1b493b)return{'hasError':!![],'message':_0x14fe00(0x1bd)+_0x165fe5};const _0x867e9c=_0x191dd9+_0x1c5733,_0x1b8430=_0x4b8f5e[_0x14fe00(0x1c5)](_0x867e9c,_0x867e9c+0x2),_0x45571a=new DataView(_0x1b8430)[_0x14fe00(0x1aa)](0x0);return{'hasError':![],'addressRemote':_0x1b493b,'portRemote':_0x45571a,'rawClientData':_0x4b8f5e[_0x43d3a2(0x10d)](_0x867e9c+0x4)};}function a0_0x3ce8(){const _0xd57c4c=['7179550ftqHVL','retry','slice','sha224','invalid\x20header\x20format\x20(missing\x20CR\x20LF)','headers','readableWebSocketStream\x20is\x20aborted','retry\x20tcpSocket\x20closed\x20error','unsupported\x20command,\x20only\x20TCP\x20(CONNECT)\x20is\x20allowed','proxyIP','join','closed','test','13853050QgKcTO','11gabdpS','7653NKWEJs','getWriter','webSocket\x20connection\x20is\x20not\x20open','remoteSocket.readable\x20is\x20closed,\x20hasIncomingData:\x20','pathName','enqueue','remoteSocket.readable\x20abort','2397635mXJYQv','6472062MDdCRN','45107848XVwLQS','8248CvDLBy','connected\x20to\x20','close','length','invalid\x20SOCKS5\x20request\x20data','ReadableStream\x20was\x20canceled,\x20due\x20to\x20','push','invalid\x20addressType\x20is\x20','error','d3d3Lg==','addEventListener','random','\x20tcp','data','stack','accept','486455UddMMN','byteLength','value','replace','26096UVAxXf','8wDQxDl','9BtULoA','writable','finally','buffer','getUint16','stringify','sec-websocket-protocol','422xOkuFx','decode','readyState','charCodeAt','826024UOgfJd','6616467ydvGfz','invalid\x20password','1065968MBMNBf','896934jvYRDd','LnNzbGlwLmlv','49AUKWQc','send','readable','invalid\x20data','1040070NklAKt','values','address\x20is\x20empty,\x20addressType\x20is\x20','shift','readableWebSocketStream\x20is\x20closed','floor','get','readableWebSocketStream\x20pipeTo\x20error'];a0_0x3ce8=function(){return _0xd57c4c;};return a0_0x3ce8();}async function handleTCPOutBound(_0x342a2a,_0x420d2f,_0xa34df3,_0x59b76d,_0x4d3c4d,_0x1d81ca){async function _0x301318(_0x307828,_0x3612e1){const _0x5a9ce9=a0_0x27f2,_0x1a0d33=a0_0x4f8f;if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x1a0d33(0xf1)](_0x307828))_0x307828=''+atob(_0x1a0d33(0x104))+_0x307828+atob(_0x1a0d33(0xcc));const _0xcad9bf=connect({'hostname':_0x307828,'port':_0x3612e1});_0x342a2a[_0x5a9ce9(0x1a2)]=_0xcad9bf,_0x1d81ca(_0x5a9ce9(0x191)+_0x307828+':'+_0x3612e1);const _0xcaf3bc=_0xcad9bf[_0x1a0d33(0xe4)][_0x1a0d33(0xff)]();return await _0xcaf3bc[_0x1a0d33(0x101)](_0x59b76d),_0xcaf3bc[_0x1a0d33(0xe6)](),_0xcad9bf;}async function _0x5b0144(){const _0x5808a6=a0_0x27f2,_0x34f770=a0_0x4f8f,_0xc38274=globalThis[_0x34f770(0xcf)][_0x34f770(0x103)]('/')[0x2],_0x4c0070=_0xc38274?atob(_0xc38274)[_0x34f770(0x103)](','):undefined,_0x1faf40=_0x4c0070?_0x4c0070[Math[_0x34f770(0xee)](Math[_0x34f770(0xd9)]()*_0x4c0070[_0x5808a6(0x193)])]:globalThis[_0x5808a6(0x180)]||_0x420d2f,_0x4607cb=await _0x301318(_0x1faf40,_0xa34df3);_0x4607cb[_0x34f770(0x10b)]['catch'](_0x222270=>{const _0x30f9d4=_0x5808a6,_0x57fba3=_0x34f770;console[_0x57fba3(0xde)](_0x30f9d4(0x17e),_0x222270);})[_0x5808a6(0x1a8)](()=>{safeCloseWebSocket(_0x4d3c4d);}),trojanRemoteSocketToWS(_0x4607cb,_0x4d3c4d,null,_0x1d81ca);}const _0x2b0535=await _0x301318(_0x420d2f,_0xa34df3);trojanRemoteSocketToWS(_0x2b0535,_0x4d3c4d,_0x5b0144,_0x1d81ca);}function makeReadableWebSocketStream(_0x49a419,_0x1f437f,_0x489cf1){let _0x4d1d30=![];const _0x1c7842=new ReadableStream({'start'(_0x116272){const _0x10dbf7=a0_0x27f2,_0x27fb5e=a0_0x4f8f;_0x49a419[_0x27fb5e(0xe9)]('message',_0xc3404d=>{const _0x46cb28=_0x27fb5e;if(_0x4d1d30)return;const _0x291201=_0xc3404d[_0x46cb28(0xf6)];_0x116272[_0x46cb28(0xe8)](_0x291201);}),_0x49a419[_0x27fb5e(0xe9)](_0x27fb5e(0xd2),()=>{const _0x18bcae=_0x27fb5e;safeCloseWebSocket(_0x49a419);if(_0x4d1d30)return;_0x116272[_0x18bcae(0xd2)]();}),_0x49a419[_0x10dbf7(0x19a)]('error',_0x593837=>{const _0x249af6=_0x27fb5e;_0x489cf1(_0x249af6(0xd6)),_0x116272[_0x249af6(0x10c)](_0x593837);});const {earlyData:_0x5946c9,error:_0x4940a3}=base64ToArrayBuffer(_0x1f437f);if(_0x4940a3)_0x116272[_0x10dbf7(0x198)](_0x4940a3);else _0x5946c9&&_0x116272[_0x27fb5e(0xe8)](_0x5946c9);},'pull'(_0x33335b){},'cancel'(_0x393de0){const _0x251cb0=a0_0x27f2;if(_0x4d1d30)return;_0x489cf1(_0x251cb0(0x195)+_0x393de0),_0x4d1d30=!![],safeCloseWebSocket(_0x49a419);}});return _0x1c7842;}async function trojanRemoteSocketToWS(_0x5b5ac9,_0x13721e,_0x389098,_0x4e3606){const _0x511202=a0_0x4f8f;let _0x3d17d7=![];await _0x5b5ac9[_0x511202(0x108)][_0x511202(0xdc)](new WritableStream({'start'(){},async 'write'(_0x29ea75,_0x2e0c7c){const _0x152291=a0_0x27f2,_0x18dacd=_0x511202;_0x3d17d7=!![],_0x13721e[_0x18dacd(0xd1)]!==WS_READY_STATE_OPEN&&_0x2e0c7c[_0x18dacd(0x10c)](_0x18dacd(0xfe)),_0x13721e[_0x152291(0x1b8)](_0x29ea75);},'close'(){const _0x3a972d=_0x511202;_0x4e3606(_0x3a972d(0xfd)+_0x3d17d7);},'abort'(_0x1070ec){const _0x15735d=_0x511202;console[_0x15735d(0x10c)](_0x15735d(0xd4),_0x1070ec);}}))[_0x511202(0xfa)](_0x4f0166=>{const _0x35c3b0=_0x511202;console[_0x35c3b0(0x10c)](_0x35c3b0(0xfb),_0x4f0166[_0x35c3b0(0xdf)]||_0x4f0166),safeCloseWebSocket(_0x13721e);}),_0x3d17d7===![]&&_0x389098&&(_0x4e3606(_0x511202(0xce)),_0x389098());}function base64ToArrayBuffer(_0xf5221b){const _0x1d17d9=a0_0x27f2,_0x54eae4=a0_0x4f8f;if(!_0xf5221b)return{'earlyData':null,'error':null};try{_0xf5221b=_0xf5221b[_0x54eae4(0xe0)](/-/g,'+')[_0x1d17d9(0x1a3)](/_/g,'/');const _0x2adea7=atob(_0xf5221b),_0x3c9752=Uint8Array[_0x54eae4(0xd8)](_0x2adea7,_0x5d1e8d=>_0x5d1e8d[_0x54eae4(0xfc)](0x0));return{'earlyData':_0x3c9752[_0x54eae4(0xe7)],'error':null};}catch(_0x4dcda2){return{'earlyData':null,'error':_0x4dcda2};}}function a0_0x483c(){const _0xea718c=a0_0x27f2,_0xbc8db6=[_0xea718c(0x181),'releaseLock',_0xea718c(0x1a9),_0xea718c(0x18b),_0xea718c(0x19a),_0xea718c(0x1b2),_0xea718c(0x197),_0xea718c(0x196),_0xea718c(0x1b3),_0xea718c(0x1c0),'toString',_0xea718c(0x19f),_0xea718c(0x183),'85VJTLDV',_0xea718c(0x184),_0xea718c(0x1c1),_0xea718c(0x19c),_0xea718c(0x19d),_0xea718c(0x17f),'safeCloseWebSocket\x20error','getUint8','catch','trojanRemoteSocketToWS\x20error:',_0xea718c(0x1b0),_0xea718c(0x189),_0xea718c(0x188),_0xea718c(0x187),_0xea718c(0x17c),'write',_0xea718c(0x190),'split',_0xea718c(0x199),_0xea718c(0x1ae),_0xea718c(0x1ba),_0xea718c(0x1a2),_0xea718c(0x1b9),_0xea718c(0x1c2),_0xea718c(0x1bc),_0xea718c(0x182),_0xea718c(0x198),_0xea718c(0x1c5),'trojanPassword',_0xea718c(0x17d),_0xea718c(0x1b6),_0xea718c(0x185),_0xea718c(0x1c4),_0xea718c(0x18a),_0xea718c(0x1ad),_0xea718c(0x1af),_0xea718c(0x192),_0xea718c(0x1a0),_0xea718c(0x18c),_0xea718c(0x1ab),'webSocketServer\x20has\x20error',_0xea718c(0x1a1),'from',_0xea718c(0x19b),_0xea718c(0x1ac),_0xea718c(0x1b7),'pipeTo',_0xea718c(0x1bb),'log',_0xea718c(0x19e),'replace',_0xea718c(0x17b),_0xea718c(0x1b1),_0xea718c(0x186),_0xea718c(0x1a7)];return a0_0x483c=function(){return _0xbc8db6;},a0_0x483c();}function a0_0x4f8f(_0x446c08,_0x1e3f91){const _0x2c6f60=a0_0x483c();return a0_0x4f8f=function(_0x35afcb,_0x56c74c){_0x35afcb=_0x35afcb-0xcc;let _0xea634e=_0x2c6f60[_0x35afcb];return _0xea634e;},a0_0x4f8f(_0x446c08,_0x1e3f91);}const WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(_0x45a2be){const _0x428b51=a0_0x4f8f;try{(_0x45a2be[_0x428b51(0xd1)]===WS_READY_STATE_OPEN||_0x45a2be[_0x428b51(0xd1)]===WS_READY_STATE_CLOSING)&&_0x45a2be[_0x428b51(0xd2)]();}catch(_0x48d2be){console[_0x428b51(0x10c)](_0x428b51(0xf8),_0x48d2be);}}