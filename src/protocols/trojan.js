(function(_0x546cbd,_0x39055a){const _0x4b7b19=a0_0x5bd9,_0x5cdb8d=_0x546cbd();while(!![]){try{const _0x413aef=parseInt(_0x4b7b19(0x161))/0x1+parseInt(_0x4b7b19(0x16b))/0x2+parseInt(_0x4b7b19(0x151))/0x3+parseInt(_0x4b7b19(0x17a))/0x4+parseInt(_0x4b7b19(0x17c))/0x5+parseInt(_0x4b7b19(0x152))/0x6+parseInt(_0x4b7b19(0x14b))/0x7*(-parseInt(_0x4b7b19(0x15f))/0x8);if(_0x413aef===_0x39055a)break;else _0x5cdb8d['push'](_0x5cdb8d['shift']());}catch(_0x28d05e){_0x5cdb8d['push'](_0x5cdb8d['shift']());}}}(a0_0x414c,0xd6a48));function a0_0x5bd9(_0x23e05a,_0x53f555){const _0x414c58=a0_0x414c();return a0_0x5bd9=function(_0x5bd95c,_0x1d2863){_0x5bd95c=_0x5bd95c-0x136;let _0x24d9af=_0x414c58[_0x5bd95c];return _0x24d9af;},a0_0x5bd9(_0x23e05a,_0x53f555);}function a0_0x27f2(_0x5de7ef,_0x34dffc){const _0x412ff9=a0_0x3ce8();return a0_0x27f2=function(_0x5ca941,_0xd0a62f){_0x5ca941=_0x5ca941-0x17b;let _0x324fa6=_0x412ff9[_0x5ca941];return _0x324fa6;},a0_0x27f2(_0x5de7ef,_0x34dffc);}(function(_0xc407da,_0x118c28){const _0x474599=a0_0x5bd9,_0xf40c58=a0_0x27f2,_0x3735a4=_0xc407da();while(!![]){try{const _0x11d240=-parseInt(_0xf40c58(0x1b4))/0x1+-parseInt(_0xf40c58(0x1a5))/0x2*(parseInt(_0xf40c58(0x1b5))/0x3)+parseInt(_0xf40c58(0x1a4))/0x4+-parseInt(_0xf40c58(0x18d))/0x5+-parseInt(_0xf40c58(0x18e))/0x6+-parseInt(_0xf40c58(0x1c3))/0x7+parseInt(_0xf40c58(0x18f))/0x8*(parseInt(_0xf40c58(0x1a6))/0x9);if(_0x11d240===_0x118c28)break;else _0x3735a4[_0x474599(0x13c)](_0x3735a4[_0x474599(0x142)]());}catch(_0x3ed281){_0x3735a4['push'](_0x3735a4['shift']());}}}(a0_0x3ce8,0xc3227),function(_0x54f72e,_0x246418){const _0x33b623=a0_0x27f2,_0x31ff66=a0_0x4f8f,_0x1d50ba=_0x54f72e();while(!![]){try{const _0x2feb38=-parseInt(_0x31ff66(0xd3))/0x1+-parseInt(_0x31ff66(0xd0))/0x2*(parseInt(_0x31ff66(0xe3))/0x3)+-parseInt(_0x31ff66(0x102))/0x4*(parseInt(_0x31ff66(0xf2))/0x5)+parseInt(_0x31ff66(0xdd))/0x6+-parseInt(_0x31ff66(0xdb))/0x7*(parseInt(_0x31ff66(0xe2))/0x8)+parseInt(_0x31ff66(0xea))/0x9+-parseInt(_0x31ff66(0xf3))/0xa*(-parseInt(_0x31ff66(0xcd))/0xb);if(_0x2feb38===_0x246418)break;else _0x1d50ba[_0x33b623(0x196)](_0x1d50ba[_0x33b623(0x1be)]());}catch(_0x18f92b){_0x1d50ba[_0x33b623(0x196)](_0x1d50ba[_0x33b623(0x1be)]());}}}(a0_0x483c,0x7cd28));import{connect}from'cloudflare:sockets';import a0_0x3a49f6 from'js-sha256';export async function trojanOverWSHandler(_0x31c5ea){const _0x3d92fc=a0_0x4f8f,_0x230144=new WebSocketPair(),[_0x27d605,_0x466963]=Object[_0x3d92fc(0x10a)](_0x230144);_0x466963[_0x3d92fc(0xf0)]();let _0x436b00='',_0x241035='';const _0x13e34c=(_0x5d568f,_0x17e3d6)=>{const _0x519530=a0_0x5bd9;console[_0x519530(0x138)]('['+_0x436b00+':'+_0x241035+']\x20'+_0x5d568f,_0x17e3d6||'');},_0x1b7982=_0x31c5ea[_0x3d92fc(0x100)][_0x3d92fc(0xf4)](_0x3d92fc(0xda))||'',_0x18455a=makeReadableWebSocketStream(_0x466963,_0x1b7982,_0x13e34c);let _0x548115={'value':null},_0xd78a29=null;return _0x18455a[_0x3d92fc(0xdc)](new WritableStream({async 'write'(_0x5b2a70,_0x8bc4){const _0x15d49a=a0_0x5bd9,_0x41b14d=_0x3d92fc;if(_0xd78a29)return _0xd78a29(_0x5b2a70);if(_0x548115[_0x41b14d(0x107)]){const _0x59a375=_0x548115[_0x41b14d(0x107)][_0x41b14d(0xe4)][_0x41b14d(0xff)]();await _0x59a375[_0x15d49a(0x16e)](_0x5b2a70),_0x59a375[_0x41b14d(0xe6)]();return;}const {hasError:_0x3cb2ef,message:_0x45702e,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawClientData:_0x262938}=await parseTrojanHeader(_0x5b2a70);_0x436b00=addressRemote,_0x241035=portRemote+'--'+Math[_0x41b14d(0xd9)]()+_0x41b14d(0xf5);if(_0x3cb2ef){throw new Error(_0x45702e);return;}handleTCPOutBound(_0x548115,addressRemote,portRemote,_0x262938,_0x466963,_0x13e34c);},'close'(){const _0x31f75f=a0_0x27f2;_0x13e34c(_0x31f75f(0x1bf));},'abort'(_0x20adc0){const _0x422bdb=_0x3d92fc;_0x13e34c(_0x422bdb(0x10f),JSON[_0x422bdb(0xd5)](_0x20adc0));}}))[_0x3d92fc(0xfa)](_0x39ab21=>{const _0x21e087=_0x3d92fc;_0x13e34c(_0x21e087(0x109),_0x39ab21);}),new Response(null,{'status':0x65,'webSocket':_0x27d605});}async function parseTrojanHeader(_0x20c571){const _0x1ef33f=a0_0x27f2,_0x2f6929=a0_0x4f8f;if(_0x20c571[_0x2f6929(0xd7)]<0x38)return{'hasError':!![],'message':_0x2f6929(0x106)};let _0x510b61=0x38;if(new Uint8Array(_0x20c571[_0x2f6929(0x10d)](0x38,0x39))[0x0]!==0xd||new Uint8Array(_0x20c571[_0x1ef33f(0x1c5)](0x39,0x3a))[0x0]!==0xa)return{'hasError':!![],'message':_0x2f6929(0xe1)};const _0x46490e=new TextDecoder()[_0x2f6929(0x105)](_0x20c571[_0x2f6929(0x10d)](0x0,_0x510b61));if(_0x46490e!==a0_0x3a49f6[_0x1ef33f(0x1c6)](globalThis[_0x2f6929(0x10e)]))return{'hasError':!![],'message':_0x2f6929(0xed)};const _0x252728=_0x20c571[_0x2f6929(0x10d)](_0x510b61+0x2);if(_0x252728[_0x2f6929(0xd7)]<0x6)return{'hasError':!![],'message':_0x1ef33f(0x194)};const _0x522991=new DataView(_0x252728),_0x424c48=_0x522991[_0x2f6929(0xf9)](0x0);if(_0x424c48!==0x1)return{'hasError':!![],'message':_0x2f6929(0xf7)};const _0x17d863=_0x522991[_0x2f6929(0xf9)](0x1);let _0x189369=0x0,_0x226ddc=0x2,_0x796319='';switch(_0x17d863){case 0x1:_0x189369=0x4,_0x796319=new Uint8Array(_0x252728[_0x2f6929(0x10d)](_0x226ddc,_0x226ddc+_0x189369))[_0x2f6929(0xe5)]('.');break;case 0x3:_0x189369=new Uint8Array(_0x252728[_0x2f6929(0x10d)](_0x226ddc,_0x226ddc+0x1))[0x0],_0x226ddc+=0x1,_0x796319=new TextDecoder()[_0x1ef33f(0x1ae)](_0x252728[_0x1ef33f(0x1c5)](_0x226ddc,_0x226ddc+_0x189369));break;case 0x4:_0x189369=0x10;const _0xf03ee8=new DataView(_0x252728[_0x2f6929(0x10d)](_0x226ddc,_0x226ddc+_0x189369)),_0x2f4152=[];for(let _0x4b336d=0x0;_0x4b336d<0x8;_0x4b336d++){_0x2f4152[_0x2f6929(0xec)](_0xf03ee8[_0x1ef33f(0x1aa)](_0x4b336d*0x2)[_0x2f6929(0xef)](0x10));}_0x796319=_0x2f4152[_0x2f6929(0xe5)](':');break;default:return{'hasError':!![],'message':_0x2f6929(0xeb)+_0x17d863};}if(!_0x796319)return{'hasError':!![],'message':_0x1ef33f(0x1bd)+_0x17d863};const _0x24ef2d=_0x226ddc+_0x189369,_0x2ba2da=_0x252728[_0x1ef33f(0x1c5)](_0x24ef2d,_0x24ef2d+0x2),_0x55a0dd=new DataView(_0x2ba2da)[_0x1ef33f(0x1aa)](0x0);return{'hasError':![],'addressRemote':_0x796319,'portRemote':_0x55a0dd,'rawClientData':_0x252728[_0x2f6929(0x10d)](_0x24ef2d+0x4)};}function a0_0x3ce8(){const _0x5012d4=a0_0x5bd9,_0x51dc1a=['7179550ftqHVL',_0x5012d4(0x158),_0x5012d4(0x13f),_0x5012d4(0x176),_0x5012d4(0x13e),'headers','readableWebSocketStream\x20is\x20aborted',_0x5012d4(0x136),_0x5012d4(0x15c),_0x5012d4(0x14d),_0x5012d4(0x182),_0x5012d4(0x15b),_0x5012d4(0x15e),_0x5012d4(0x146),_0x5012d4(0x145),_0x5012d4(0x140),_0x5012d4(0x143),'webSocket\x20connection\x20is\x20not\x20open',_0x5012d4(0x147),_0x5012d4(0x150),_0x5012d4(0x149),'remoteSocket.readable\x20abort',_0x5012d4(0x177),_0x5012d4(0x170),_0x5012d4(0x175),'8248CvDLBy',_0x5012d4(0x16d),_0x5012d4(0x181),'length',_0x5012d4(0x13a),_0x5012d4(0x17f),_0x5012d4(0x13c),'invalid\x20addressType\x20is\x20',_0x5012d4(0x17b),_0x5012d4(0x15d),'addEventListener',_0x5012d4(0x166),_0x5012d4(0x17d),'data',_0x5012d4(0x137),_0x5012d4(0x178),_0x5012d4(0x162),_0x5012d4(0x15a),_0x5012d4(0x165),_0x5012d4(0x157),_0x5012d4(0x14e),'8wDQxDl',_0x5012d4(0x155),_0x5012d4(0x16f),_0x5012d4(0x184),_0x5012d4(0x17e),_0x5012d4(0x14c),_0x5012d4(0x14a),_0x5012d4(0x153),_0x5012d4(0x16c),'decode','readyState',_0x5012d4(0x154),_0x5012d4(0x14f),_0x5012d4(0x160),_0x5012d4(0x173),'1065968MBMNBf',_0x5012d4(0x141),_0x5012d4(0x186),_0x5012d4(0x171),_0x5012d4(0x172),_0x5012d4(0x148),_0x5012d4(0x185),'1040070NklAKt',_0x5012d4(0x16a),_0x5012d4(0x179),_0x5012d4(0x142),_0x5012d4(0x159),_0x5012d4(0x180),_0x5012d4(0x167),_0x5012d4(0x168)];return a0_0x3ce8=function(){return _0x51dc1a;},a0_0x3ce8();}function a0_0x414c(){const _0x4b965b=['pathName','4843218fGcRpW','3365628QngJEU','sec-websocket-protocol','charCodeAt','9BtULoA','getUint8','replace','retry','readableWebSocketStream\x20is\x20closed','byteLength','closed','unsupported\x20command,\x20only\x20TCP\x20(CONNECT)\x20is\x20allowed','d3d3Lg==','test','5289832jmZSlG','6616467ydvGfz','490586dwuANk','486455UddMMN','trojanRemoteSocketToWS\x20error:','toString','value','random','get','readableWebSocketStream\x20pipeTo\x20error','safeCloseWebSocket\x20error','values','524822DYWRyr','422xOkuFx','connected\x20to\x20','write','writable','6472062MDdCRN','49AUKWQc','send','invalid\x20password','catch','45107848XVwLQS','sha224','2397635mXJYQv','accept','address\x20is\x20empty,\x20addressType\x20is\x20','750204pLJdKv','error','2041000cAuCAa','\x20tcp','buffer','ReadableStream\x20was\x20canceled,\x20due\x20to\x20','floor','close','join','split','finally','invalid\x20data','LnNzbGlwLmlv','retry\x20tcpSocket\x20closed\x20error','stack','log','85VJTLDV','invalid\x20SOCKS5\x20request\x20data','from','push','message','invalid\x20header\x20format\x20(missing\x20CR\x20LF)','slice','7653NKWEJs','896934jvYRDd','shift','getWriter','pipeTo','11gabdpS','13853050QgKcTO','remoteSocket.readable\x20is\x20closed,\x20hasIncomingData:\x20','readable','enqueue','stringify','28IWXdMr','getUint16','proxyIP','26096UVAxXf','826024UOgfJd'];a0_0x414c=function(){return _0x4b965b;};return a0_0x414c();}async function handleTCPOutBound(_0xe34b9a,_0x467729,_0x13cd1e,_0x1516a5,_0x565473,_0x5345b2){async function _0x220f89(_0x39795e,_0x5e69dd){const _0x40cbc0=a0_0x27f2,_0x331bc0=a0_0x4f8f;if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x331bc0(0xf1)](_0x39795e))_0x39795e=''+atob(_0x331bc0(0x104))+_0x39795e+atob(_0x331bc0(0xcc));const _0x4a67cf=connect({'hostname':_0x39795e,'port':_0x5e69dd});_0xe34b9a[_0x40cbc0(0x1a2)]=_0x4a67cf,_0x5345b2(_0x40cbc0(0x191)+_0x39795e+':'+_0x5e69dd);const _0x3a280e=_0x4a67cf[_0x331bc0(0xe4)][_0x331bc0(0xff)]();return await _0x3a280e[_0x331bc0(0x101)](_0x1516a5),_0x3a280e[_0x331bc0(0xe6)](),_0x4a67cf;}async function _0x139416(){const _0x355968=a0_0x5bd9,_0x2c1d75=a0_0x27f2,_0x1402ce=a0_0x4f8f,_0x4cee91=globalThis[_0x1402ce(0xcf)][_0x1402ce(0x103)]('/')[0x2],_0x4407fb=_0x4cee91?atob(_0x4cee91)[_0x1402ce(0x103)](','):undefined,_0x21e2f4=_0x4407fb?_0x4407fb[Math[_0x1402ce(0xee)](Math[_0x1402ce(0xd9)]()*_0x4407fb[_0x2c1d75(0x193)])]:globalThis[_0x2c1d75(0x180)]||_0x467729,_0x14632f=await _0x220f89(_0x21e2f4,_0x13cd1e);_0x14632f[_0x1402ce(0x10b)][_0x355968(0x174)](_0x3e2b41=>{const _0x5cc446=_0x2c1d75,_0x4e5d22=_0x1402ce;console[_0x4e5d22(0xde)](_0x5cc446(0x17e),_0x3e2b41);})[_0x2c1d75(0x1a8)](()=>{safeCloseWebSocket(_0x565473);}),trojanRemoteSocketToWS(_0x14632f,_0x565473,null,_0x5345b2);}const _0x3e2428=await _0x220f89(_0x467729,_0x13cd1e);trojanRemoteSocketToWS(_0x3e2428,_0x565473,_0x139416,_0x5345b2);}function makeReadableWebSocketStream(_0x37b73d,_0x305a22,_0x55bbca){let _0x1fbbb7=![];const _0x228a92=new ReadableStream({'start'(_0x3790cb){const _0x1d7b93=a0_0x5bd9,_0x41f321=a0_0x27f2,_0x513f8d=a0_0x4f8f;_0x37b73d[_0x513f8d(0xe9)](_0x1d7b93(0x13d),_0x447cf7=>{const _0x38c464=_0x513f8d;if(_0x1fbbb7)return;const _0x8299d1=_0x447cf7[_0x38c464(0xf6)];_0x3790cb[_0x38c464(0xe8)](_0x8299d1);}),_0x37b73d[_0x513f8d(0xe9)](_0x513f8d(0xd2),()=>{const _0x4ff8f5=_0x513f8d;safeCloseWebSocket(_0x37b73d);if(_0x1fbbb7)return;_0x3790cb[_0x4ff8f5(0xd2)]();}),_0x37b73d[_0x41f321(0x19a)](_0x1d7b93(0x17b),_0x13b543=>{const _0x22c1ee=_0x513f8d;_0x55bbca(_0x22c1ee(0xd6)),_0x3790cb[_0x22c1ee(0x10c)](_0x13b543);});const {earlyData:_0x51e386,error:_0x4d5d8d}=base64ToArrayBuffer(_0x305a22);if(_0x4d5d8d)_0x3790cb[_0x41f321(0x198)](_0x4d5d8d);else _0x51e386&&_0x3790cb[_0x513f8d(0xe8)](_0x51e386);},'pull'(_0x7adf1f){},'cancel'(_0x4638a8){const _0x2ea4ba=a0_0x27f2;if(_0x1fbbb7)return;_0x55bbca(_0x2ea4ba(0x195)+_0x4638a8),_0x1fbbb7=!![],safeCloseWebSocket(_0x37b73d);}});return _0x228a92;}async function trojanRemoteSocketToWS(_0x12f20d,_0x3aa96c,_0x303d8b,_0x297557){const _0x5f5d5f=a0_0x4f8f;let _0x5a46a7=![];await _0x12f20d[_0x5f5d5f(0x108)][_0x5f5d5f(0xdc)](new WritableStream({'start'(){},async 'write'(_0x9f4314,_0x2d7b86){const _0x4eca6b=a0_0x27f2,_0x3c1470=_0x5f5d5f;_0x5a46a7=!![],_0x3aa96c[_0x3c1470(0xd1)]!==WS_READY_STATE_OPEN&&_0x2d7b86[_0x3c1470(0x10c)](_0x3c1470(0xfe)),_0x3aa96c[_0x4eca6b(0x1b8)](_0x9f4314);},'close'(){const _0x1a0152=_0x5f5d5f;_0x297557(_0x1a0152(0xfd)+_0x5a46a7);},'abort'(_0x169cc7){const _0x416765=_0x5f5d5f;console[_0x416765(0x10c)](_0x416765(0xd4),_0x169cc7);}}))[_0x5f5d5f(0xfa)](_0x536d3a=>{const _0x20e4f6=_0x5f5d5f;console[_0x20e4f6(0x10c)](_0x20e4f6(0xfb),_0x536d3a[_0x20e4f6(0xdf)]||_0x536d3a),safeCloseWebSocket(_0x3aa96c);}),_0x5a46a7===![]&&_0x303d8b&&(_0x297557(_0x5f5d5f(0xce)),_0x303d8b());}function base64ToArrayBuffer(_0x15100d){const _0x477633=a0_0x27f2,_0x16c9dd=a0_0x4f8f;if(!_0x15100d)return{'earlyData':null,'error':null};try{_0x15100d=_0x15100d[_0x16c9dd(0xe0)](/-/g,'+')[_0x477633(0x1a3)](/_/g,'/');const _0x35e81c=atob(_0x15100d),_0x236b4b=Uint8Array[_0x16c9dd(0xd8)](_0x35e81c,_0x2a9971=>_0x2a9971[_0x16c9dd(0xfc)](0x0));return{'earlyData':_0x236b4b[_0x16c9dd(0xe7)],'error':null};}catch(_0x2ea4ec){return{'earlyData':null,'error':_0x2ea4ec};}}function a0_0x483c(){const _0x7f2710=a0_0x5bd9,_0x19f633=a0_0x27f2,_0x5cf78b=[_0x19f633(0x181),'releaseLock',_0x19f633(0x1a9),_0x19f633(0x18b),_0x19f633(0x19a),_0x19f633(0x1b2),_0x19f633(0x197),_0x19f633(0x196),_0x19f633(0x1b3),_0x19f633(0x1c0),_0x7f2710(0x164),_0x19f633(0x19f),_0x19f633(0x183),_0x7f2710(0x139),_0x19f633(0x184),_0x19f633(0x1c1),_0x19f633(0x19c),_0x19f633(0x19d),_0x19f633(0x17f),_0x7f2710(0x169),_0x7f2710(0x156),_0x7f2710(0x174),_0x7f2710(0x163),_0x19f633(0x1b0),_0x19f633(0x189),_0x19f633(0x188),_0x19f633(0x187),_0x19f633(0x17c),_0x7f2710(0x16e),_0x19f633(0x190),_0x7f2710(0x183),_0x19f633(0x199),_0x19f633(0x1ae),_0x19f633(0x1ba),_0x19f633(0x1a2),_0x19f633(0x1b9),_0x19f633(0x1c2),_0x19f633(0x1bc),_0x19f633(0x182),_0x19f633(0x198),_0x19f633(0x1c5),'trojanPassword',_0x19f633(0x17d),_0x19f633(0x1b6),_0x19f633(0x185),_0x19f633(0x1c4),_0x19f633(0x18a),_0x19f633(0x1ad),_0x19f633(0x1af),_0x19f633(0x192),_0x19f633(0x1a0),_0x19f633(0x18c),_0x19f633(0x1ab),'webSocketServer\x20has\x20error',_0x19f633(0x1a1),_0x7f2710(0x13b),_0x19f633(0x19b),_0x19f633(0x1ac),_0x19f633(0x1b7),_0x7f2710(0x144),_0x19f633(0x1bb),'log',_0x19f633(0x19e),_0x7f2710(0x157),_0x19f633(0x17b),_0x19f633(0x1b1),_0x19f633(0x186),_0x19f633(0x1a7)];return a0_0x483c=function(){return _0x5cf78b;},a0_0x483c();}function a0_0x4f8f(_0x598aa0,_0x2b1b5d){const _0xc38b19=a0_0x483c();return a0_0x4f8f=function(_0x55a58c,_0x3d799e){_0x55a58c=_0x55a58c-0xcc;let _0x11ba19=_0xc38b19[_0x55a58c];return _0x11ba19;},a0_0x4f8f(_0x598aa0,_0x2b1b5d);}const WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(_0x4dd498){const _0x3da885=a0_0x4f8f;try{(_0x4dd498[_0x3da885(0xd1)]===WS_READY_STATE_OPEN||_0x4dd498[_0x3da885(0xd1)]===WS_READY_STATE_CLOSING)&&_0x4dd498[_0x3da885(0xd2)]();}catch(_0x90a631){console[_0x3da885(0x10c)](_0x3da885(0xf8),_0x90a631);}}